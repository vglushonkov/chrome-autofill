<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Fields Test - Fields Autofill Extension</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f4f8;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2563eb;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #f8fafc;
        }
        
        .test-section h3 {
            color: #1e40af;
            margin-top: 0;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #374151;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            border-color: #3b82f6;
            outline: none;
        }
        
        button {
            background-color: #3b82f6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2563eb;
        }
        
        .instructions {
            background-color: #ecfdf5;
            border: 1px solid #10b981;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .instructions h4 {
            color: #047857;
            margin-top: 0;
        }
        
        .dynamic-field {
            background-color: #fef3c7;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .stable-field {
            background-color: #dbeafe;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .counter {
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dynamic Fields Test - Enhanced Selectors</h1>
        
        <div class="instructions">
            <h4>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:</h4>
            <ol>
                <li><strong>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è</strong> –≤ –ø–æ–ª—è —Å –ø–æ–º–æ—â—å—é –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é (–ü–ö–ú ‚Üí Autofill)</li>
                <li><strong>–î–æ–±–∞–≤—å—Ç–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è</strong> –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ</li>
                <li><strong>–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É</strong> - –≤—Å–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–∏—Ç—å—Å—è</li>
                <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏</strong> - —Å–º–µ–Ω–∞ –ø–æ—Ä—è–¥–∫–∞, –Ω–æ–≤—ã–µ ID, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤</li>
            </ol>
        </div>

        <!-- Test 1: Stable Fields -->
        <div class="test-section">
            <h3>1. –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –ø–æ–ª—è (–¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–ª–∏—á–Ω–æ)</h3>
            <div class="stable-field">
                <div class="form-group">
                    <label for="stable-email">Email (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π ID –∏ name):</label>
                    <input type="email" id="stable-email" name="email" placeholder="your.email@example.com" aria-label="Email address">
                </div>
                
                <div class="form-group">
                    <label for="stable-name">–ò–º—è (—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã):</label>
                    <input type="text" id="stable-name" name="fullName" placeholder="–í–∞—à–µ –ø–æ–ª–Ω–æ–µ –∏–º—è" data-field="name">
                </div>
                
                <div class="form-group">
                    <label for="stable-phone">–¢–µ–ª–µ—Ñ–æ–Ω (—Å aria-label):</label>
                    <input type="tel" id="stable-phone" name="phone" placeholder="+7 (000) 000-00-00" aria-label="Phone number">
                </div>
            </div>
        </div>

        <!-- Test 2: Dynamic ID Fields -->
        <div class="test-section">
            <h3>2. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ ID (—Ç–µ—Å—Ç fuzzy matching)</h3>
            <div class="dynamic-field" id="dynamic-container">
                <div class="form-group">
                    <label>Email —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º ID:</label>
                    <input type="email" id="user-email-12345" name="userEmail" placeholder="email@domain.com" class="email-field">
                </div>
                
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º ID:</label>
                    <input type="password" id="pwd-67890" name="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" class="pwd-input">
                </div>
            </div>
            
            <button onclick="regenerateDynamicIds()">üîÑ –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Å –Ω–æ–≤—ã–º–∏ ID</button>
            <button onclick="changeClasses()">üé® –ò–∑–º–µ–Ω–∏—Ç—å –∫–ª–∞—Å—Å—ã</button>
        </div>

        <!-- Test 3: Position-based Fields -->
        <div class="test-section">
            <h3>3. –ü–æ–ª—è —Å –∏–∑–º–µ–Ω—è—é—â–µ–π—Å—è –ø–æ–∑–∏—Ü–∏–µ–π</h3>
            <div id="position-container">
                <div class="form-group">
                    <label>–ü–æ–ª–µ 1 (–º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –ø–æ–∑–∏—Ü–∏—é):</label>
                    <input type="text" name="field1" placeholder="–ü–µ—Ä–≤–æ–µ –ø–æ–ª–µ" class="position-field">
                </div>
                
                <div class="form-group">
                    <label>–ü–æ–ª–µ 2 (–º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –ø–æ–∑–∏—Ü–∏—é):</label>
                    <input type="text" name="field2" placeholder="–í—Ç–æ—Ä–æ–µ –ø–æ–ª–µ" class="position-field">
                </div>
                
                <div class="form-group">
                    <label>–ü–æ–ª–µ 3 (–º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –ø–æ–∑–∏—Ü–∏—é):</label>
                    <input type="text" name="field3" placeholder="–¢—Ä–µ—Ç—å–µ –ø–æ–ª–µ" class="position-field">
                </div>
            </div>
            
            <button onclick="shuffleFields()">üîÄ –ü–µ—Ä–µ–º–µ—à–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π</button>
            <button onclick="addFieldBetween()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –º–µ–∂–¥—É</button>
        </div>

        <!-- Test 4: Contextual Fields -->
        <div class="test-section">
            <h3>4. –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–æ–ª—è (–ø–æ label –∏ —Ñ–æ—Ä–º–µ)</h3>
            <form class="user-registration-form">
                <fieldset>
                    <legend>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</legend>
                    
                    <div class="form-group">
                        <label>–õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                        <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
                    </div>
                    
                    <div class="form-group">
                        <label>–ü–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞:</label>
                        <input type="password" placeholder="–ü–∞—Ä–æ–ª—å">
                    </div>
                </fieldset>
            </form>
            
            <form class="contact-form" style="margin-top: 20px;">
                <fieldset>
                    <legend>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</legend>
                    
                    <div class="form-group">
                        <label>–†–∞–±–æ—á–∏–π email:</label>
                        <input type="email" placeholder="work@company.com">
                    </div>
                    
                    <div class="form-group">
                        <label>–ú–æ–±–∏–ª—å–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω:</label>
                        <input type="tel" placeholder="–ú–æ–±–∏–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä">
                    </div>
                </fieldset>
            </form>
        </div>

        <!-- Test 5: Dynamically Added Fields -->
        <div class="test-section">
            <h3>5. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º—ã–µ –ø–æ–ª—è</h3>
            <div id="dynamic-form-container">
                <!-- –ü–æ–ª—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
            </div>
            
            <button onclick="addEmailField()">üìß –î–æ–±–∞–≤–∏—Ç—å email –ø–æ–ª–µ</button>
            <button onclick="addPhoneField()">üìû –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ–ª–µ</button>
            <button onclick="addCustomField()">‚úèÔ∏è –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –ø–æ–ª–µ</button>
            <button onclick="clearDynamicFields()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
        </div>

        <div class="counter" id="field-counter">
            –í—Å–µ–≥–æ –ø–æ–ª–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: <span id="total-fields">0</span>
        </div>
    </div>

    <script>
        let dynamicCounter = 0;
        let fieldCounter = 0;
        
        // Update field counter
        function updateFieldCounter() {
            const fields = document.querySelectorAll('input, textarea, select');
            document.getElementById('total-fields').textContent = fields.length;
        }
        
        // Test 2: Dynamic ID regeneration
        function regenerateDynamicIds() {
            const container = document.getElementById('dynamic-container');
            const emailField = container.querySelector('input[type="email"]');
            const passwordField = container.querySelector('input[type="password"]');
            
            // Generate new random IDs
            emailField.id = `user-email-${Math.floor(Math.random() * 99999)}`;
            passwordField.id = `pwd-${Math.floor(Math.random() * 99999)}`;
            
            console.log('Generated new IDs:', emailField.id, passwordField.id);
        }
        
        function changeClasses() {
            const container = document.getElementById('dynamic-container');
            const emailField = container.querySelector('input[type="email"]');
            const passwordField = container.querySelector('input[type="password"]');
            
            // Change classes to dynamic ones
            emailField.className = `email-field-${Math.floor(Math.random() * 1000)}`;
            passwordField.className = `pwd-input-${Math.floor(Math.random() * 1000)}`;
            
            console.log('Changed classes:', emailField.className, passwordField.className);
        }
        
        // Test 3: Position shuffling
        function shuffleFields() {
            const container = document.getElementById('position-container');
            const fields = Array.from(container.children);
            
            // Shuffle array
            for (let i = fields.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [fields[i], fields[j]] = [fields[j], fields[i]];
            }
            
            // Re-append in new order
            fields.forEach(field => container.appendChild(field));
            console.log('Fields shuffled');
        }
        
        function addFieldBetween() {
            const container = document.getElementById('position-container');
            const newField = document.createElement('div');
            newField.className = 'form-group';
            newField.innerHTML = `
                <label>–ù–æ–≤–æ–µ –ø–æ–ª–µ (–≤—Å—Ç–∞–≤–ª–µ–Ω–æ):</label>
                <input type="text" name="inserted-${Date.now()}" placeholder="–í—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ –ø–æ–ª–µ" class="position-field">
            `;
            
            // Insert at random position
            const children = container.children;
            const randomIndex = Math.floor(Math.random() * children.length);
            container.insertBefore(newField, children[randomIndex]);
            
            updateFieldCounter();
        }
        
        // Test 5: Dynamic field addition
        function addEmailField() {
            const container = document.getElementById('dynamic-form-container');
            dynamicCounter++;
            
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'form-group dynamic-field';
            fieldDiv.innerHTML = `
                <label>–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π Email #${dynamicCounter}:</label>
                <input type="email" 
                       id="dyn-email-${dynamicCounter}-${Date.now()}" 
                       name="dynamicEmail${dynamicCounter}" 
                       placeholder="dynamic.email${dynamicCounter}@test.com"
                       class="dynamic-email-${dynamicCounter}"
                       data-counter="${dynamicCounter}">
            `;
            
            container.appendChild(fieldDiv);
            updateFieldCounter();
        }
        
        function addPhoneField() {
            const container = document.getElementById('dynamic-form-container');
            dynamicCounter++;
            
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'form-group dynamic-field';
            fieldDiv.innerHTML = `
                <label>–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –¢–µ–ª–µ—Ñ–æ–Ω #${dynamicCounter}:</label>
                <input type="tel" 
                       id="dyn-phone-${dynamicCounter}-${Math.random().toString(36).substr(2, 9)}" 
                       name="dynamicPhone${dynamicCounter}" 
                       placeholder="+7 (999) 123-45-67"
                       class="dynamic-phone phone-field-${dynamicCounter}"
                       data-counter="${dynamicCounter}">
            `;
            
            container.appendChild(fieldDiv);
            updateFieldCounter();
        }
        
        function addCustomField() {
            const container = document.getElementById('dynamic-form-container');
            fieldCounter++;
            
            const fieldTypes = ['text', 'email', 'tel', 'password'];
            const randomType = fieldTypes[Math.floor(Math.random() * fieldTypes.length)];
            
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'form-group dynamic-field';
            fieldDiv.innerHTML = `
                <label>–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –ø–æ–ª–µ #${fieldCounter} (${randomType}):</label>
                <input type="${randomType}" 
                       id="custom-${randomType}-${fieldCounter}-${Math.random().toString(36).substr(2, 5)}" 
                       name="customField${fieldCounter}" 
                       placeholder="–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ ${randomType} –ø–æ–ª–µ"
                       class="custom-field-${fieldCounter} type-${randomType}"
                       data-field-number="${fieldCounter}"
                       data-field-type="${randomType}">
            `;
            
            container.appendChild(fieldDiv);
            updateFieldCounter();
        }
        
        function clearDynamicFields() {
            document.getElementById('dynamic-form-container').innerHTML = '';
            dynamicCounter = 0;
            fieldCounter = 0;
            updateFieldCounter();
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateFieldCounter();
            
            // Add some initial dynamic fields
            setTimeout(() => {
                addEmailField();
                addPhoneField();
            }, 100);
        });
        
        // Monitor field changes
        setInterval(updateFieldCounter, 2000);
        
        // Prevent form submissions
        document.addEventListener('submit', function(e) {
            e.preventDefault();
            alert('–§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!');
        });
    </script>
</body>
</html>
